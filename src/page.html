<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Testing Page</title>
  <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>

<div class="sign-in"><button>Sign In</button></div>
<div class="get-user-data"><button>Get User Data</button></div>
<div class="log-hours"><button>Log Hours</button></div>
<div class="get-hours"><button>Get Hours</button></div>

<script>
// function setProfile(profileName, profilePicURL){
//   // Display profile
//   console.log(profileName)
//   console.log(profilePicURL)
// }

function signIn(){
  const client = google.accounts.oauth2.initCodeClient({
    client_id: '672955273389-bc25j23ds73qgp7ukroaloutv2a22qjv.apps.googleusercontent.com',
    // scope: 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/contacts.readonly https://www.googleapis.com/auth/directory.readonly',
    scope: 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile',
    ux_mode: 'popup',
    callback: (response) => {
      fetch("./auth", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "javascript-fetch"
        },
        body: JSON.stringify({code: response.code, host: document.location.host})
      })
      .then(res => res.json())
      .then(data => console.log(data))
    },
  });

  client.requestCode()
}

function getUserData(){
  fetch("./user", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Requested-With": "javascript-fetch"
    },
    body: JSON.stringify({"user_id": "56d26180-ff2e-11ed-ac97-659b7a975caa"})
  }).then(
    async data => console.log(await data.json()),
    async err => console.log(err)
  )
}

function logHours(){
  fetch("./user-log", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Requested-With": "javascript-fetch"
    },
    body: JSON.stringify({
      "user_id": "56d26180-ff2e-11ed-ac97-659b7a975caa",
      "initiative_id": "aaa",
      "prep_time": true,
      "duration": 500
    })
  }).then(
    async data => console.log(await data.json()),
    async err => console.log(err)
  )
}

function getHours(){
  fetch("./user-initiatives", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Requested-With": "javascript-fetch"
    },
    body: JSON.stringify({ "user_id": "56d26180-ff2e-11ed-ac97-659b7a975caa" })
  }).then(
    async data => console.log(await data.json()),
    async err => console.log(err)
  )
}

// Send custom headers for authentication
fetch("./auth", {
  headers: {
    "Content-Type": "application/json",
    "X-Requested-With": "javascript-fetch"
  }
})
.then(async res => {
  // Switch for error code?
  if (res.status != 200){
    // Display log in button
    document.getElementsByClassName("sign-in")[0]
      .children[0].addEventListener("click", signIn);
    return;
  }

  console.log(await res.json());

  document.getElementsByClassName("get-user-data")[0]
    .children[0].addEventListener("click", getUserData);
  document.getElementsByClassName("log-hours")[0]
    .children[0].addEventListener("click", logHours);
  document.getElementsByClassName("get-hours")[0]
    .children[0].addEventListener("click", getHours);
})

</script>
</body>
</html>
