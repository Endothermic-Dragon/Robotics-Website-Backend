<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Testing Page</title>
  <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>

<div class="sign-in"><button>Sign In</button></div>

<script>
// function setProfile(profileName, profilePicURL){
//   // Display profile
//   console.log(profileName)
//   console.log(profilePicURL)
// }

function signIn(){
  const client = google.accounts.oauth2.initCodeClient({
    client_id: '672955273389-bc25j23ds73qgp7ukroaloutv2a22qjv.apps.googleusercontent.com',
    // scope: 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/contacts.readonly https://www.googleapis.com/auth/directory.readonly',
    scope: 'https://www.googleapis.com/auth/userinfo.profile',
    ux_mode: 'popup',
    callback: (response) => {
      fetch("./auth", {
        method: "POST",
        body: JSON.stringify({code: response.code, host: document.location.host}),
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "javascript-fetch"
        }
      })
      .then(res => res.json())
      .then(data => console.log(data))
    },
  });

  client.requestCode()
}

// Send custom headers for authentication
fetch("./auth", {
  headers: {
    "Content-Type": "application/json",
    "X-Requested-With": "javascript-fetch"
  }
})
.then(async res => {
  // Switch for error code?
  if (res.status != 200){
    // Display log in button
    let button = document.getElementsByClassName("sign-in")[0]
    return button.children[0].addEventListener("click", signIn)
  }

  // Display profile data
  let data = await res.json()
  console.log(data);
  // setProfile(data.name, data.photo)
})

</script>
</body>
</html>